#!/bin/bash

function __besman_check_requirements
{
    local requirements
    requirements=("java" "mvn")

    for i in requirements
    do
        if [[ -z $(which $i) ]]; then
            echo "$i not found"
            return 1
        fi
    done
}

function __besman_download_payload
{
    local payload_url payload
    payload_url=https://github.com/Be-Secure-Google-POC/fastjson
    git clone $payload_url -d $HOME/payload

}

function __besman_check_payload_exist
{
    local payload
    payload=$HOME/payload

    if [[ ! -d "$payload" ]]; then
        __besman_download_payload
    else
        return 0
    fi
}

function __besman_check_fastjson_exist
{
    local fastjson_dir
    fastjson_dir=$1

    if [[ ! -d $fastjson_dir ]]; then
        echo "Could not find fastjson"
        return 1
    else
        return 0
    fi
   
}

function __besman_execute_exploit
{
    local payload_dir fastjson_dir
    payload_dir=$HOME/payload
    fastjson_dir=$1
    cd $payload_dir
    git checkout v1.2.24-BeSp2
    
}
function __besman_playbook_run
{
    local fastjson_dir=$1

    __besman_check_requirements
    [[ "$?" -eq 1 ]] && return 1

    __besman_check_fastjson_exist "$fastjson_dir"
    [[ "$?" -eq 1 ]] && return 1

    __besman_check_payload_exist


}